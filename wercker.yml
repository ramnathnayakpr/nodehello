box: node

build:
    steps:
  
    - script:
        name: Install express 
        code: npm install express
    
    - script:
        name: Copy files over to root 
        code: cp -R /pipeline/source/* /
    
    - internal/docker-push: 
        username: $USERNAME
        password: $PASSWORD
        registry: https://lhr.ocir.io
        repository: lhr.ocir.io/intrnayak/nodehello
        tag: latest

rolling-update:
    steps:
  
    - script:
        name: whoami 
        code: whoami
    
    - script:
        name: which kubectl 
        code: which kubectl

    - kubectl:
      server: $KUBERNETES_MASTER
      username: $KUBERNETES_USERNAME
      password: $KUBERNETES_PASSWORD
      insecure-skip-tls-verify: true
      command: rolling-update nodehello
      image: ramnathn/nodehello